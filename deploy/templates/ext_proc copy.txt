from core.Stream import Stream
from core.Sender import Sender
from core.AgentProcess import AgentProcess
from core.Agent import *


from oauth2client import gce
from apiclient.discovery import build
import httplib2
import base64

def get_tq():
    credentials = gce.AppAssertionCredentials('')
    http = httplib2.Http()
    http=credentials.authorize(http)
    credentials.refresh(http)
    service = build('taskqueue', 'v1beta2', http=http)
    tq = service.tasks()
    return tq

def process_contents(ext_in_stream_list, ext_out_stream_list):
    tq = get_tq()
    AgentTaskQueue(ext_in_stream_list, ext_out_stream_list, ext_in_stream_list,
                   '{{ instance }}', tq)

external_in_streams = {{ external_in_streams }}
external_out_streams = {{ external_out_streams }}

{{ name }} = AgentProcess('{{ name }}', 
                          external_in_streams,
                          external_out_streams,
                          process_contents)